---
import { loadQuery } from '../lib/loadQuery';
import BaseLayout from '../layouts/BaseLayout.astro';
import ConnectSection from '../components/connect/Connect.astro';
import connectData from '../data/connect.json';
import type { ProfessionalLink } from '../types';

const FORMSPREE_ID = 'mlgednnn';

// Fetch contact data from Sanity
const settings = await loadQuery<any>({
  query: `
    *[_type == "siteSettings"][0] {
      contactInfo,
      professionalLinks[] {
        "id": _key,
        type,
        label,
        url,
        icon
      },
      sectionContent
    }
  `
});

const professionalLinks = (settings?.professionalLinks || []) as ProfessionalLink[];
---

<BaseLayout title="Connect - Mike Lacey">
  <ConnectSection
    contactInfo={settings?.contactInfo || connectData.contactInfo}
    professionalLinks={professionalLinks}
    formFields={connectData.formFields}
    sectionContent={settings?.sectionContent || connectData.sectionContent}
    formspreeId={FORMSPREE_ID}
  />
</BaseLayout>
