---
import { loadQuery } from '../lib/loadQuery';
import BaseLayout from '../layouts/BaseLayout.astro';
import WorkSection from '../components/work/Work.astro';

// Detect preview mode from URL (Sanity Presentation tool)
const preview = Astro.url.searchParams.has('preview') || Astro.url.searchParams.has('sanity-preview');

// Fetch work data and page content from Sanity
const [credits, photos, interviews, pageContent] = await Promise.all([
  loadQuery<any[]>({
    preview,
    query: `
      *[_type == "credit"] | order(name asc) {
        "id": _id,
        name,
        network
      }
    `
  }),
  loadQuery<any[]>({
    preview,
    query: `
      *[_type == "photo"] {
        "id": _id,
        "src": image.asset->url,
        "alt": image.alt,
        "caption": image.caption
      }
    `
  }),
  loadQuery<any[]>({
    preview,
    query: `
      *[_type == "interview"] {
        "id": _id,
        title,
        description,
        videoType,
        youtubeUrl,
        directVideoUrl
      }
    `
  }),
  loadQuery<any>({
    preview,
    query: `*[_type == "siteSettings"][0].workPage`
  })
]);
---

<BaseLayout title="My Work - Mike Lacey">
  <WorkSection
    credits={credits}
    photos={photos}
    interviews={interviews}
    pageContent={pageContent}
  />
</BaseLayout>
