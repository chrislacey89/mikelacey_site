---
import { sanityClient } from 'sanity:client';
import BaseLayout from '../layouts/BaseLayout.astro';
import HomeHero from '../components/home/HomeHero.astro';
import type { CTA } from '../types';

// Fetch site settings from Sanity
const settings = await sanityClient.fetch(`
  *[_type == "siteSettings"][0] {
    hero {
      "backgroundImage": backgroundImage.asset->url,
      headline,
      tagline
    },
    profile {
      name,
      title,
      "headshotImage": headshotImage.asset->url,
      subtitle
    },
    ctas[] {
      "id": _key,
      label,
      href,
      variant
    }
  }
`);

const ctas: CTA[] = (settings?.ctas || []).map((cta: { id: string; label: string; href: string; variant: string }) => {
  if (cta.variant !== 'primary' && cta.variant !== 'secondary') {
    throw new Error(`Invalid CTA variant: ${cta.variant}`);
  }
  return {
    ...cta,
    variant: cta.variant as 'primary' | 'secondary',
  };
});
---

<BaseLayout title="Mike Lacey - Television Director">
  <HomeHero
    hero={settings?.hero}
    profile={settings?.profile}
    ctas={ctas}
  />
</BaseLayout>
