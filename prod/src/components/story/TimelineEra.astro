---
import type { TimelineEvent } from '../../types';

interface Props {
  event: TimelineEvent;
  isFirst?: boolean;
  isLast?: boolean;
}

const { event, isFirst = false, isLast = false } = Astro.props;

// Split narrative into paragraphs
const paragraphs = event.narrative.split('\n\n');

// Generate era ID for NLE timeline navigation
const eraId = `${event.year}-${event.title.toLowerCase().replace(/[^a-z0-9]+/g, '-')}`;
---

<div
  class="relative grid grid-cols-1 md:grid-cols-[120px_1fr] gap-4 md:gap-8"
  data-era={eraId}
  id={`era-${event.year}`}
>
  <!-- Year Marker (Desktop: left column, Mobile: inline) -->
  <div class="md:text-right">
    <span class="text-2xl md:text-3xl font-bold text-blue-600 dark:text-blue-400">
      {event.year}
    </span>
  </div>

  <!-- Content -->
  <div class="relative pb-12">
    <!-- Timeline Line (Desktop only) -->
    <div class="hidden md:block absolute left-0 top-0 bottom-0 w-px -translate-x-4">
      {!isFirst && <div class="absolute top-0 left-0 w-px h-4 bg-stone-300 dark:bg-stone-700"></div>}
      <div class={`absolute top-4 left-0 w-px ${isLast ? 'h-4' : 'h-full'} bg-stone-300 dark:bg-stone-700`}></div>
    </div>

    <!-- Timeline Dot (Desktop only) -->
    <div class="hidden md:block absolute left-0 top-1 w-3 h-3 -translate-x-[22px] rounded-full bg-blue-600 dark:bg-blue-400 ring-4 ring-stone-50 dark:ring-stone-950"></div>

    <!-- Era Title -->
    <h3 class="text-sm font-semibold uppercase tracking-wider text-stone-500 dark:text-stone-400 mb-4">
      {event.title}
    </h3>

    <!-- Narrative -->
    <div class="prose prose-stone dark:prose-invert max-w-none">
      {paragraphs.map((paragraph) => (
        <p class="text-stone-700 dark:text-stone-300 leading-relaxed mb-4 last:mb-0">
          {paragraph}
        </p>
      ))}
    </div>

    <!-- Optional Photo -->
    {event.photo && (
      <div class="mt-6">
        <img
          src={event.photo}
          alt={event.title}
          class="rounded-lg shadow-lg max-w-md"
          loading="lazy"
          decoding="async"
        />
      </div>
    )}
  </div>
</div>
